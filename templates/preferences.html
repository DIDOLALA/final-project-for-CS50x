{% extends "base.html" %}
{% block title %}{{ _('title_preferences') }}{% endblock %}

{% block body %}
<div class="info-content-wrapper">
  <h4 class="main-title">{{ _('pref_hdr') }}</h4>

  <form id="preferences-form" method="post">
    <input type="hidden" name="user_id" value="{{ user_id }}">

    <!-- ================= Page 1 ================= -->
    <div class="page" id="page-1" data-bg-img="{{ url_for('static', filename='images/pf_bg1.jpg') }}">
      <div class="cards-container">
        <!-- Question 1 -->
        <div class="info-card">
          <h4>{{ _('pref_q1') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="social" value="热闹喧嚣" required>
              {{ _('pref_lively') }}
            </label>
            <label class="option-item">
              <input type="radio" name="social" value="安静独处">
              {{ _('pref_quiet') }}
            </label>
          </div>
        </div>

        <!-- Question 2 -->
        <div class="info-card">
          <h4>{{ _('pref_q2') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="exploration" value="勇敢探索" required>
              {{ _('pref_explore') }}
            </label>
            <label class="option-item">
              <input type="radio" name="exploration" value="稳妥安全">
              {{ _('pref_safe') }}
            </label>
          </div>
        </div>

        <!--Question 3 -->
        <div class="info-card">
          <h4>{{ _('pref_q3') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="popularity" value="大众热门景点" required>
              {{ _('pref_popular') }}
            </label>
            <label class="option-item">
              <input type="radio" name="popularity" value="小众冷门去处">
              {{ _('pref_hidden') }}
            </label>
          </div>
        </div>
      </div>

      <button type="button" class="submit-button" onclick="nextPage(2)">{{ _('btn_next') }}</button>
    </div>

    <!-- ================= Page 2 ================= -->
    <div class="page" id="page-2" style="display:none" data-bg-img="{{ url_for('static', filename='images/pf_bg2.jpg') }}">
      <div class="cards-container">
        <div class="info-card">
          <h4>{{ _('pref_value') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="value" value="享受美食和放松身心" required>
              {{ _('value_food_relax') }}
            </label>
            <label class="option-item">
              <input type="radio" name="value" value="获得新知与个人成长">
              {{ _('value_growth') }}
            </label>
            <label class="option-item">
              <input type="radio" name="value" value="结交朋友与分享快乐">
              {{ _('value_social') }}
            </label>
          </div>
        </div>

        <div class="info-card">
          <h4>{{ _('pref_experience') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="experience" value="当地生活与传统手工" required>
              {{ _('exp_local') }}
            </label>
            <label class="option-item">
              <input type="radio" name="experience" value="休闲放松与疗愈康养">
              {{ _('exp_relax') }}
            </label>
            <label class="option-item">
              <input type="radio" name="experience" value="宗教灵性与神秘体验">
              {{ _('exp_spirit') }}
            </label>
            <label class="option-item">
              <input type="radio" name="experience" value="运动挑战与极限探险">
              {{ _('exp_adventure') }}
            </label>
          </div>
        </div>

        <div class="info-card">
          <h4>{{ _('pref_culture') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="culture" value="自然与风光" required>
              {{ _('culture_nature') }}
            </label>
            <label class="option-item">
              <input type="radio" name="culture" value="历史与文化">
              {{ _('culture_history') }}
            </label>
            <label class="option-item">
              <input type="radio" name="culture" value="宗教与民族">
              {{ _('culture_religion') }}
            </label>
            <label class="option-item">
              <input type="radio" name="culture" value="艺术与设计">
              {{ _('culture_art') }}
            </label>
            <label class="option-item">
              <input type="radio" name="culture" value="美食与娱乐">
              {{ _('culture_food') }}
            </label>
          </div>
        </div>
      </div>

      <button type="button" class="submit-button" onclick="nextPage(3)">{{ _('btn_next') }}</button>
    </div>

    <!-- ================= Page 3 ================= -->
    <div class="page" id="page-3" style="display:none" data-bg-img="{{ url_for('static', filename='images/pf_bg3.jpg') }}">
      <div class="cards-container">
        <div class="info-card">
          <h4>{{ _('pref_scene') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="scene" value="自然" required>
              {{ _('scene_nature') }}
            </label>
            <label class="option-item">
              <input type="radio" name="scene" value="乡村">
              {{ _('scene_village') }}
            </label>
            <label class="option-item">
              <input type="radio" name="scene" value="古城">
              {{ _('scene_ancient') }}
            </label>
            <label class="option-item">
              <input type="radio" name="scene" value="都市">
              {{ _('scene_city') }}
            </label>
          </div>
        </div>

        <div class="info-card">
          <h4>{{ _('pref_landscape') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="landscape" value="高原" required>
              {{ _('landscape_plateau') }}
            </label>
            <label class="option-item">
              <input type="radio" name="landscape" value="山地">
              {{ _('landscape_mountain') }}
            </label>
            <label class="option-item">
              <input type="radio" name="landscape" value="平原">
              {{ _('landscape_plain') }}
            </label>
            <label class="option-item">
              <input type="radio" name="landscape" value="海岛">
              {{ _('landscape_island') }}
            </label>
          </div>
        </div>

        <div class="info-card">
          <h4>{{ _('pref_life') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="life" value="植物" required>
              {{ _('life_plant') }}
            </label>
            <label class="option-item">
              <input type="radio" name="life" value="动物">
              {{ _('life_animal') }}
            </label>
            <label class="option-item">
              <input type="radio" name="life" value="人类">
              {{ _('life_human') }}
            </label>
            <label class="option-item">
              <input type="radio" name="life" value="无生命">
              {{ _('life_none') }}
            </label>
          </div>
        </div>
      </div>

      <button type="button" class="submit-button" onclick="nextPage(4)">{{ _('btn_next') }}</button>
    </div>

    <!-- ================= Page 4 ================= -->
    <div class="page" id="page-4" style="display:none" data-bg-img="{{ url_for('static', filename='images/pf_bg4.jpg') }}">
      <div class="cards-container">
        <div class="info-card">
          <h4>{{ _('pref_taste') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="taste" value="麻辣" required>
              {{ _('taste_spicy') }}
            </label>
            <label class="option-item">
              <input type="radio" name="taste" value="酸甜">
              {{ _('taste_sweet_sour') }}
            </label>
            <label class="option-item">
              <input type="radio" name="taste" value="咸香">
              {{ _('taste_salty') }}
            </label>
            <label class="option-item">
              <input type="radio" name="taste" value="鲜甜清淡">
              {{ _('taste_light') }}
            </label>
            <label class="option-item">
              <input type="radio" name="taste" value="香料浓郁">
              {{ _('taste_aromatic') }}
            </label>
          </div>
        </div>

        <div class="info-card">
          <h4>{{ _('pref_food_att') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="food_attitude" value="非常愿意尝试" required>
              {{ _('att_willing') }}
            </label>
            <label class="option-item">
              <input type="radio" name="food_attitude" value="愿意尝试">
              {{ _('att_maybe') }}
            </label>
            <label class="option-item">
              <input type="radio" name="food_attitude" value="不太愿意尝试">
              {{ _('att_unwilling') }}
            </label>
          </div>
        </div>

        <div class="info-card">
          <h4>{{ _('pref_food_exp') }}</h4>
          <div class="form-options">
            <label class="option-item">
              <input type="radio" name="food_exp" value="街头小吃" required>
              {{ _('food_street') }}
            </label>
            <label class="option-item">
              <input type="radio" name="food_exp" value="市井风味">
              {{ _('food_local') }}
            </label>
            <label class="option-item">
              <input type="radio" name="food_exp" value="精致料理">
              {{ _('food_fine') }}
            </label>
          </div>
        </div>
      </div>

      <button type="submit" id="submit-btn" class="submit-button">{{ _('btn_submit') }}</button>
    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const imgPath = document.getElementById('page-1').dataset.bgImg;
  document.querySelector('.main-bg-container').style.backgroundImage = `url(${imgPath})`;
  nextPage(1);
});

let currentPage = 1;

function nextPage(n){
  document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
  const target = document.getElementById('page-'+n);
  target.style.display = 'block';

  const imgPath = target.dataset.bgImg;
  document.querySelector('.main-bg-container').style.backgroundImage = `url(${imgPath})`;
}

document.getElementById('preferences-form').addEventListener('submit', function (e) {
  const btn = document.getElementById('submit-btn');
  if (btn.disabled) {
    e.preventDefault();
    return;
  }

  btn.disabled = true;
  btn.innerText = "{{ _('btn_waiting') }}";

  setTimeout(function () {
    btn.disabled = false;
    btn.innerText = "{{ _('btn_submit') }}";
  }, 60000);
});
</script>
{% endblock %}